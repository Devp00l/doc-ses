<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<!-- influenced by http://ceph.com/docs/master/install/upgrading-ceph/ -->
<chapter id="cha.ceph.upgrade">
 <title>Upgrading from Previous Releases</title>
 <para>
  This chapter introduces steps to upgrade &storage; from the previous
  release to the current one.
 </para>
 <sect1 id="ceph.upgrade.general">
  <title>General Upgrade Procedure</title>

  <para>
   Before upgrading the &ceph; cluster itself, you need to add a new version
   of the &storage; product to the existing operating system, and update the
   software to the latest versions on each cluster node. You can upgrade
   daemons in your cluster while the cluster is online and in service.
   Certain types of daemons depend upon others. For example &ceph; &rgw;s
   depend upon &ceph; monitors and &ceph; OSD daemons. We recommend
   upgrading in this order:
  </para>

  <orderedlist>
   <listitem>
    <para>
     &ceph; monitors.
    </para>
   </listitem>
   <listitem>
    <para>
     &ceph; OSD daemons.
    </para>
   </listitem>
   <listitem>
    <para>
     &ceph; &rgw;s.
    </para>
   </listitem>
  </orderedlist>

  <tip>
   <para>
    We recommend upgrading all the daemons of a specific type&mdash;for
    example all monitor daemons or all OSD daemons&mdash;one by one to
    ensure that they are all on the same release. We also recommend that you
    upgrade all the daemons in your cluster before you try to exercise new
    functionality in a release.
   </para>
   <para>
    After all the daemons of a specific type are upgraded, check their
    status.
   </para>
   <para>
    Ensure each monitor has rejoined the quorum after all monitors are
    upgraded:
   </para>
<screen>ceph mon stat</screen>
   <para>
    Ensure each &ceph; OSD daemon has rejoined the cluster after all OSDs
    are upgraded:
   </para>
<screen>ceph osd stat</screen>
  </tip>

  <procedure>
   <step>
    <para>
     Check that the latest patches are applied to the installed &sls;.
    </para>
<screen>sudo zypper ref &amp;&amp; sudo zypper patch</screen>
   </step>
   <step>
    <para>
     Install &storage; extension with
     <menuchoice><guimenu>&yast;</guimenu><guimenu>Software</guimenu><guimenu>Add-On
     Products</guimenu><guimenu>Add</guimenu></menuchoice>.
    </para>
   </step>
   <step>
    <para>
     After the new product is added, refresh the installed software
     repositories.
    </para>
<screen>sudo zypper ref</screen>
   </step>
   <step>
    <para>
     Upgrade the installed software to the new version.
    </para>
<screen>sudo zypper dup</screen>
   </step>
   <step>
    <para>
     After the last &ceph; node is upgraded, check the cluster status.
    </para>
<screen>ceph health</screen>
   </step>
  </procedure>
 </sect1>
</chapter>
