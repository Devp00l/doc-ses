<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE appendix
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<appendix xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="app.storage.manual_inst">
 <title>Example Procedure of Manual &ceph; Installation</title>
 <para>
  The following procedure shows the commands that you need to install &ceph;
  storage cluster manually.
 </para>
 <procedure>
  <step>
   <para>
    Generate the key secrets for the &ceph; services you plan to run.
    You can use the following command to generate it:
   </para>
<screen>python -c "import os ; import struct ; import time; import base64 ; \
 key = os.urandom(16) ; header = struct.pack('&lt;hiih',1,int(time.time()),0,len(key)) ; \
 print base64.b64encode(header + key)"</screen>
  </step>
  <step>
   <para>
    Add the keys to the related keyrings. First for <systemitem class="username">client.admin</systemitem>, 
    then for monitors, and then other related services, such as OSD, &rgw;, or MDS:
   </para>
<screen>/usr/bin/ceph-authtool -n client.admin \
 --create-keyring /etc/ceph/ceph.client.admin.keyring \
 --add-key AQBR8KhWgKw6FhAAoXvTT6MdBE+bV+zPKzIo6w== \
 --cap mds 'allow *' --cap mon 'allow *' --cap osd 'allow *'

/usr/bin/ceph-authtool -n mon. \
 --create-keyring /var/lib/ceph/bootstrap-mon/ceph-osceph-03.keyring \
 --add-key AQB/8KhWmIfENBAABq8EEbzCJMjEFoazMNb+oQ== \
 --set-uid=0 --cap mon 'allow *'

/usr/bin/ceph-authtool -n client.bootstrap-osd \
 --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring \
 --add-key AQCxU6dWKJzuEBAAjh0WSiThjl+Ruvj3QCsDDQ== \
 --cap mon 'allow profile bootstrap-osd'

/usr/bin/ceph-authtool -n client.bootstrap-rgw \
 --create-keyring /var/lib/ceph/bootstrap-rgw/ceph.keyring \
 --add-key AQDant1WGP7qJBAA1Iqr9YoNo4YExai4ieXYMg== \
 --cap mon 'allow profile bootstrap-rgw'

/usr/bin/ceph-authtool -n client.bootstrap-mds \
 --create-keyring /var/lib/ceph/bootstrap-mds/ceph.keyring \
 --add-key AQADn91WzLT9OBAA+LqKkXFBzwszBX4QkCkFYw== \
 --cap mon 'allow profile bootstrap-mds'</screen>
  </step>
  <step>
   <para>
    Create a monmap&mdash;a database of all monitors in a cluster:
   </para>
<screen>monmaptool --create --fsid eaac9695-4265-4ca8-ac2a-f3a479c559b1 \
 /tmp/tmpuuhxm3/monmap
monmaptool --add osceph-02 192.168.43.60 /tmp/tmpuuhxm3/monmap
monmaptool --add osceph-03 192.168.43.96 /tmp/tmpuuhxm3/monmap
monmaptool --add osceph-04 192.168.43.80 /tmp/tmpuuhxm3/monmap</screen>
  </step>
  <step>
   <para>
    Create a new keyring
    and import keys from the admin and monitors' keyrings there. 
    You can then use them to start the monitors.
   </para>
  </step>
 </procedure>
</appendix>
